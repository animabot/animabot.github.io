<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>ANIMA: emgm.m Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://www.mathjax.org/mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ANIMA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_5ce0a585544ccf90f6c4541b827e0dfc.html">anima-nightly-src</a></li><li class="navelem"><a class="el" href="dir_0fad36fe10bbcca9e7c6f0593f8115a7.html">filtering</a></li><li class="navelem"><a class="el" href="dir_a8c965e58a3e16f0722aea8ebc1f2ff0.html">nyul_standardization</a></li><li class="navelem"><a class="el" href="dir_369872ed032a3cd8f5543300e1c0f96c.html">matlab_intensity_standardization</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">emgm.m</div>  </div>
</div><!--header-->
<div class="contents">
<a href="emgm_8m.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="emgm_8m.html#aa536745b29be7cb86f06124adedc5cc8">    1</a></span>&#160;<span class="keyword">function</span> [label, model, llh] = emgm(X, init, prob_prior)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;% Perform EM algorithm <span class="keywordflow">for</span> fitting the Gaussian mixture model.</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;%   X: <a class="code" href="reslice__nii_8m.html#a1aabac6d068eef6a7bad3fdf50a05cc8">d</a> x n data matrix</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;%   init: <a class="code" href="reslice__nii_8m.html#adc468c70fb574ebd07287b38d0d0676d">k</a> (1 x 1) or label (1 x n, 1&lt;=label(<a class="code" href="reslice__nii_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>)&lt;=<a class="code" href="reslice__nii_8m.html#adc468c70fb574ebd07287b38d0d0676d">k</a>) or center (<a class="code" href="reslice__nii_8m.html#a1aabac6d068eef6a7bad3fdf50a05cc8">d</a> x <a class="code" href="reslice__nii_8m.html#adc468c70fb574ebd07287b38d0d0676d">k</a>)</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;%  </div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;%   prob_prior : <a class="code" href="hellier__hist__normalization__gmm_8m.html#ab66251c08e0241221a1f306f8c4760f5">if</a> <a class="code" href="emgm_8m.html#ab66c175905713a9576f36f2fe09b9f21">Flag</a> 0, the labels are <a class="code" href="emgm_8m.html#aa536745b29be7cb86f06124adedc5cc8">integer</a>, Flag 1, the labels are</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;%   probabilities</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;%% initialization</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<a class="code" href="emgm_8m.html#a5d9facf29f2bc931a29b0059e419d62f">fprintf</a>(&#39;EM <a class="code" href="hellier__hist__normalization__gmm_8m.html#a4797586c9f191ec7ffd84e764c4c54e7">for</a> Gaussian mixture: running ... \n&#39;);</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno"><a class="line" href="emgm_8m.html#a6b45d48125a6b8b1ee140eed24a0419f">   11</a></span>&#160;<a class="code" href="emgm_8m.html#a6b45d48125a6b8b1ee140eed24a0419f">R</a> = initialization(X,init, prob_prior);</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;[~,label(1,:)] = max(<a class="code" href="emgm_8m.html#a6b45d48125a6b8b1ee140eed24a0419f">R</a>,[],2);</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;R = R(:,unique(label));</div>
<div class="line"><a name="l00014"></a><span class="lineno"><a class="line" href="emgm_8m.html#a1bdcfc0498996872a24dabb51e5f2121">   14</a></span>&#160;<a class="code" href="emgm_8m.html#a1bdcfc0498996872a24dabb51e5f2121">tol</a> = 1<a class="code" href="xform__nii_8m.html#a5389c938d8f439f89bc6549e6a18285d">e</a>-30;</div>
<div class="line"><a name="l00015"></a><span class="lineno"><a class="line" href="emgm_8m.html#a46bb007d223fe0b24732e6c9a65175b3">   15</a></span>&#160;<a class="code" href="emgm_8m.html#a46bb007d223fe0b24732e6c9a65175b3">maxiter</a> = 1500;</div>
<div class="line"><a name="l00016"></a><span class="lineno"><a class="line" href="emgm_8m.html#a9127faa9bea33783867c8bdf0c3ccfb5">   16</a></span>&#160;<a class="code" href="emgm_8m.html#a9127faa9bea33783867c8bdf0c3ccfb5">llh</a> = -inf(1,<a class="code" href="emgm_8m.html#a46bb007d223fe0b24732e6c9a65175b3">maxiter</a>);</div>
<div class="line"><a name="l00017"></a><span class="lineno"><a class="line" href="emgm_8m.html#aed6d166fcfd739c46349b18079e2f877">   17</a></span>&#160;<a class="code" href="emgm_8m.html#aed6d166fcfd739c46349b18079e2f877">converged</a> = false;</div>
<div class="line"><a name="l00018"></a><span class="lineno"><a class="line" href="emgm_8m.html#aaccc9105df5383111407fd5b41255e23">   18</a></span>&#160;<a class="code" href="emgm_8m.html#aaccc9105df5383111407fd5b41255e23">t</a> = 1;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;while ~<a class="code" href="emgm_8m.html#aed6d166fcfd739c46349b18079e2f877">converged</a> &amp;&amp; <a class="code" href="emgm_8m.html#aaccc9105df5383111407fd5b41255e23">t</a> &lt; maxiter</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <a class="code" href="emgm_8m.html#aaccc9105df5383111407fd5b41255e23">t</a> = <a class="code" href="emgm_8m.html#aaccc9105df5383111407fd5b41255e23">t</a>+1;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    model = maximization(X,R);</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    [R, <a class="code" href="emgm_8m.html#a9127faa9bea33783867c8bdf0c3ccfb5">llh</a>(t)] = expectation(X,model);</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    [~,label(1,:)] = max(R,[],2);</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    idx = unique(label);   % non-empty components</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <a class="code" href="hellier__hist__normalization__gmm_8m.html#ab66251c08e0241221a1f306f8c4760f5">if</a> size(R,2) ~= size(idx,2)</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        R = R(:,idx);   % remove empty components</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <a class="code" href="reslice__nii_8m.html#a5f512d455013d953e6018dee349e78f6">else</a></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        <a class="code" href="emgm_8m.html#aed6d166fcfd739c46349b18079e2f877">converged</a> =   <a class="code" href="emgm_8m.html#a9127faa9bea33783867c8bdf0c3ccfb5">llh</a>(t)-<a class="code" href="emgm_8m.html#a9127faa9bea33783867c8bdf0c3ccfb5">llh</a>(t-1) &lt; <a class="code" href="emgm_8m.html#a1bdcfc0498996872a24dabb51e5f2121">tol</a>*abs(<a class="code" href="emgm_8m.html#a9127faa9bea33783867c8bdf0c3ccfb5">llh</a>(t)); %</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <a class="code" href="load__nii__img_8m.html#a0e58fe5bf1f468ebd8ae6b3620a52472">end</a></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<a class="code" href="load__nii__img_8m.html#a0e58fe5bf1f468ebd8ae6b3620a52472">end</a></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<a class="code" href="emgm_8m.html#a9127faa9bea33783867c8bdf0c3ccfb5">llh</a> = <a class="code" href="emgm_8m.html#a9127faa9bea33783867c8bdf0c3ccfb5">llh</a>(2:t);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<a class="code" href="hellier__hist__normalization__gmm_8m.html#ab66251c08e0241221a1f306f8c4760f5">if</a> <a class="code" href="emgm_8m.html#aed6d166fcfd739c46349b18079e2f877">converged</a></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <a class="code" href="emgm_8m.html#a5d9facf29f2bc931a29b0059e419d62f">fprintf</a>(&#39;Converged in %<a class="code" href="reslice__nii_8m.html#a1aabac6d068eef6a7bad3fdf50a05cc8">d</a> steps.\n&#39;,t-1);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<a class="code" href="reslice__nii_8m.html#a5f512d455013d953e6018dee349e78f6">else</a></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <a class="code" href="emgm_8m.html#a5d9facf29f2bc931a29b0059e419d62f">fprintf</a>(&#39;Not <a class="code" href="emgm_8m.html#aed6d166fcfd739c46349b18079e2f877">converged</a> in %<a class="code" href="reslice__nii_8m.html#a1aabac6d068eef6a7bad3fdf50a05cc8">d</a> steps.\n&#39;,maxiter);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<a class="code" href="load__nii__img_8m.html#a0e58fe5bf1f468ebd8ae6b3620a52472">end</a></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<a class="code" href="emgm_8m.html#a67531ee5e31b1d1a3065cf637eae4546">function</a> R = initialization(X, init, prob_prior)</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;[<a class="code" href="reslice__nii_8m.html#a1aabac6d068eef6a7bad3fdf50a05cc8">d</a>,n] = size(X);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<a class="code" href="hellier__hist__normalization__gmm_8m.html#ab66251c08e0241221a1f306f8c4760f5">if</a> isstruct(init)  % initialize with <a class="code" href="reslice__nii_8m.html#a1ede835792071dff91c0e008e7c3b16a">a</a> model</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    R  = expectation(X,init);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<a class="code" href="hellier__hist__normalization__gmm_8m.html#a61c2a47b64784151e1719e8205833341">elseif</a> <a class="code" href="load__nii__img_8m.html#a706b80f8d6a58d25b3b0e0821fd2d2a1">length</a>(init) == 1  % random initialization</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <a class="code" href="reslice__nii_8m.html#adc468c70fb574ebd07287b38d0d0676d">k</a> = init;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    idx = randsample(n,<a class="code" href="reslice__nii_8m.html#adc468c70fb574ebd07287b38d0d0676d">k</a>);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="load__untouch__nii_8m.html#a33c2e9f764beb522ead31ce2394a933a">m</a> = X(:,idx);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    [~,label] = max(bsxfun(@minus,<a class="code" href="load__untouch__nii_8m.html#a33c2e9f764beb522ead31ce2394a933a">m</a>&#39;*X,sum(<a class="code" href="load__untouch__nii_8m.html#a33c2e9f764beb522ead31ce2394a933a">m</a>.^2,1)&#39;/2),[],1);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    while k ~= unique(label)</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        idx = randsample(n,k);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        m = X(:,idx);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        [~,label] = max(bsxfun(@minus,m&#39;*X,sum(m.^2,1)&#39;/2),[],1);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <a class="code" href="load__nii__img_8m.html#a0e58fe5bf1f468ebd8ae6b3620a52472">end</a></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    R = full(sparse(1:n,label,1,n,k,n));</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<a class="code" href="hellier__hist__normalization__gmm_8m.html#a61c2a47b64784151e1719e8205833341">elseif</a> size(init,1) == 1 &amp;&amp; size(init,2) == n  % initialize with labels</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;           label = init;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;           k = max(label);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;           R = full(sparse(1:n,label,1,n,k,n));</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<a class="code" href="hellier__hist__normalization__gmm_8m.html#a61c2a47b64784151e1719e8205833341">elseif</a> size(init,1) == d  %initialize with only centers</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        k = size(init,2);</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        m = init;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        [~,label] = max(bsxfun(@minus,m&#39;*X,sum(m.^2,1)&#39;/2),[],1);</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        R = full(sparse(1:n,label,1,n,k,n));</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<a class="code" href="hellier__hist__normalization__gmm_8m.html#a61c2a47b64784151e1719e8205833341">elseif</a>(prob_prior)</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;       R = init;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<a class="code" href="reslice__nii_8m.html#a5f512d455013d953e6018dee349e78f6">else</a></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <a class="code" href="load__nii__ext_8m.html#aef5461a34124216ffeadd235c3f81324">error</a>(&#39;ERROR: init is <a class="code" href="xform__nii_8m.html#a2890ce3bb7be1e5fd7e9aa65b58a2925">not</a> valid.&#39;);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<a class="code" href="load__nii__img_8m.html#a0e58fe5bf1f468ebd8ae6b3620a52472">end</a></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<a class="code" href="emgm_8m.html#a67531ee5e31b1d1a3065cf637eae4546">function</a> [R, <a class="code" href="emgm_8m.html#a9127faa9bea33783867c8bdf0c3ccfb5">llh</a>] = expectation(X, model)</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;mu = model.mu;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;Sigma = model.Sigma;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;w = model.weight;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;n = size(X,2);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;k = size(mu,2);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;logR = zeros(n,k);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<a class="code" href="hellier__hist__normalization__gmm_8m.html#a4797586c9f191ec7ffd84e764c4c54e7">for</a> <a class="code" href="reslice__nii_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 1:k</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    logR(:,<a class="code" href="reslice__nii_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>) = loggausspdf(X,mu(:,<a class="code" href="reslice__nii_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>),Sigma(:,:,i));</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<a class="code" href="load__nii__img_8m.html#a0e58fe5bf1f468ebd8ae6b3620a52472">end</a></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;logR = bsxfun(@plus,logR,log(w));</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<a class="code" href="reslice__nii_8m.html#adf1f3edb9115acb0a1e04209b7a9937b">T</a> = logsumexp(logR,2);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<a class="code" href="emgm_8m.html#a9127faa9bea33783867c8bdf0c3ccfb5">llh</a> = sum(<a class="code" href="reslice__nii_8m.html#adf1f3edb9115acb0a1e04209b7a9937b">T</a>)/n; % loglikelihood</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;logR = bsxfun(@minus,logR,<a class="code" href="reslice__nii_8m.html#adf1f3edb9115acb0a1e04209b7a9937b">T</a>);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;R = exp(logR);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<a class="code" href="emgm_8m.html#a67531ee5e31b1d1a3065cf637eae4546">function</a> model = maximization(X, R)</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;[d,n] = size(X);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;k = size(R,2);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<a class="code" href="load__lbeig_8m.html#a1af5497f0d80ec2d3e57945765f73d8c">s</a> = sum(R,1);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;w = <a class="code" href="load__lbeig_8m.html#a1af5497f0d80ec2d3e57945765f73d8c">s</a>/n;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;mu = bsxfun(@times, X*R, 1./<a class="code" href="load__lbeig_8m.html#a1af5497f0d80ec2d3e57945765f73d8c">s</a>);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;Sigma = zeros(d,d,k);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<a class="code" href="hellier__hist__normalization__gmm_8m.html#a4797586c9f191ec7ffd84e764c4c54e7">for</a> i = 1:k</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    Xo = bsxfun(@minus,X,mu(:,i));</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    Xo = bsxfun(@times,Xo,sqrt(R(:,i)&#39;));</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    Sigma(:,:,i) = Xo*Xo&#39;/s(i);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    Sigma(:,:,i) = Sigma(:,:,i)+eye(d)*(1e-6); % add <a class="code" href="reslice__nii_8m.html#a1ede835792071dff91c0e008e7c3b16a">a</a> prior <a class="code" href="hellier__hist__normalization__gmm_8m.html#a4797586c9f191ec7ffd84e764c4c54e7">for</a> numerical stability</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<a class="code" href="load__nii__img_8m.html#a0e58fe5bf1f468ebd8ae6b3620a52472">end</a></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;model.mu = mu;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;model.Sigma = Sigma;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;model.weight = w;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<a class="code" href="emgm_8m.html#a67531ee5e31b1d1a3065cf637eae4546">function</a> y = loggausspdf(X, mu, Sigma)</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;d = size(X,1);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;X = bsxfun(@minus,X,mu);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;[R,p]= chol(Sigma);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<a class="code" href="hellier__hist__normalization__gmm_8m.html#ab66251c08e0241221a1f306f8c4760f5">if</a> p ~= 0</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <a class="code" href="load__nii__ext_8m.html#aef5461a34124216ffeadd235c3f81324">error</a>(&#39;ERROR: Sigma is <a class="code" href="xform__nii_8m.html#a2890ce3bb7be1e5fd7e9aa65b58a2925">not</a> PD.&#39;);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<a class="code" href="load__nii__img_8m.html#a0e58fe5bf1f468ebd8ae6b3620a52472">end</a></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<a class="code" href="reslice__nii_8m.html#a402668afa73f28e7643901afacaeca4c">q</a> = sum((R&#39;\X).^2,1);  % quadratic term (<a class="code" href="reslice__nii_8m.html#aad05f78187c942f9dd521605fa81f1ba">M</a> distance)</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<a class="code" href="reslice__nii_8m.html#ae0323a9039add2978bf5b49550572c7c">c</a> = d*log(2*pi)+2*sum(log(diag(R)));   % normalization constant</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;y = -(<a class="code" href="reslice__nii_8m.html#ae0323a9039add2978bf5b49550572c7c">c</a>+<a class="code" href="reslice__nii_8m.html#a402668afa73f28e7643901afacaeca4c">q</a>)/2;</div>
<div class="ttc" id="emgm_8m_html_a1bdcfc0498996872a24dabb51e5f2121"><div class="ttname"><a href="emgm_8m.html#a1bdcfc0498996872a24dabb51e5f2121">tol</a></div><div class="ttdeci">tol</div><div class="ttdef"><b>Definition:</b> <a href="emgm_8m_source.html#l00014">emgm.m:14</a></div></div>
<div class="ttc" id="hellier__hist__normalization__gmm_8m_html_ab66251c08e0241221a1f306f8c4760f5"><div class="ttname"><a href="hellier__hist__normalization__gmm_8m.html#ab66251c08e0241221a1f306f8c4760f5">if</a></div><div class="ttdeci">Check the ordering of the means if(mu_i_first_subset&lt; mu_i_second_subset &amp;mu_i_first_subset&lt; mu_i_third_subset) disp('The first Gaussian is the CSF')</div></div>
<div class="ttc" id="load__untouch__nii_8m_html_a33c2e9f764beb522ead31ce2394a933a"><div class="ttname"><a href="load__untouch__nii_8m.html#a33c2e9f764beb522ead31ce2394a933a">m</a></div><div class="ttdeci">Load NIFTI or ANALYZE but not applying any appropriate affine geometric transform or voxel intensity scaling Although according to NIFTI all those header information are supposed to be applied to the loaded NIFTI there are some situations that people do want to leave the original NIFTI header and data untouched They will probably just use MATLAB to do certain image processing regardless of image and to save data back with the same NIfTI header Since this program is only served for those please use it together with save_untouch_nii m</div><div class="ttdef"><b>Definition:</b> <a href="load__untouch__nii_8m_source.html#l00001">load_untouch_nii.m:1</a></div></div>
<div class="ttc" id="load__lbeig_8m_html_a1af5497f0d80ec2d3e57945765f73d8c"><div class="ttname"><a href="load__lbeig_8m.html#a1af5497f0d80ec2d3e57945765f73d8c">s</a></div><div class="ttdeci">s</div><div class="ttdef"><b>Definition:</b> <a href="load__lbeig_8m_source.html#l00005">load_lbeig.m:5</a></div></div>
<div class="ttc" id="xform__nii_8m_html_a5389c938d8f439f89bc6549e6a18285d"><div class="ttname"><a href="xform__nii_8m.html#a5389c938d8f439f89bc6549e6a18285d">e</a></div><div class="ttdeci">hdr.dime.xyzt_units, 7 e()</div></div>
<div class="ttc" id="xform__nii_8m_html_a2890ce3bb7be1e5fd7e9aa65b58a2925"><div class="ttname"><a href="xform__nii_8m.html#a2890ce3bb7be1e5fd7e9aa65b58a2925">not</a></div><div class="ttdeci">end apply space_unit to pixdim if not(mm)%space_unit</div></div>
<div class="ttc" id="load__nii__img_8m_html_a706b80f8d6a58d25b3b0e0821fd2d2a1"><div class="ttname"><a href="load__nii__img_8m.html#a706b80f8d6a58d25b3b0e0821fd2d2a1">length</a></div><div class="ttdeci">end if length(unique(img_idx))~</div></div>
<div class="ttc" id="reslice__nii_8m_html_a402668afa73f28e7643901afacaeca4c"><div class="ttname"><a href="reslice__nii_8m.html#a402668afa73f28e7643901afacaeca4c">q</a></div><div class="ttdeci">values are q</div><div class="ttdef"><b>Definition:</b> <a href="reslice__nii_8m_source.html#l00049">reslice_nii.m:49</a></div></div>
<div class="ttc" id="emgm_8m_html_aed6d166fcfd739c46349b18079e2f877"><div class="ttname"><a href="emgm_8m.html#aed6d166fcfd739c46349b18079e2f877">converged</a></div><div class="ttdeci">converged</div><div class="ttdef"><b>Definition:</b> <a href="emgm_8m_source.html#l00017">emgm.m:17</a></div></div>
<div class="ttc" id="emgm_8m_html_a5d9facf29f2bc931a29b0059e419d62f"><div class="ttname"><a href="emgm_8m.html#a5d9facf29f2bc931a29b0059e419d62f">fprintf</a></div><div class="ttdeci">the labels are the labels are probabilities initialization fprintf('EM for Gaussian mixture:running...\n')</div></div>
<div class="ttc" id="emgm_8m_html_a9127faa9bea33783867c8bdf0c3ccfb5"><div class="ttname"><a href="emgm_8m.html#a9127faa9bea33783867c8bdf0c3ccfb5">llh</a></div><div class="ttdeci">llh</div><div class="ttdef"><b>Definition:</b> <a href="emgm_8m_source.html#l00016">emgm.m:16</a></div></div>
<div class="ttc" id="reslice__nii_8m_html_a5f512d455013d953e6018dee349e78f6"><div class="ttname"><a href="reslice__nii_8m.html#a5f512d455013d953e6018dee349e78f6">else</a></div><div class="ttdeci">end else[img M]</div><div class="ttdef"><b>Definition:</b> <a href="reslice__nii_8m_source.html#l00109">reslice_nii.m:109</a></div></div>
<div class="ttc" id="load__nii__ext_8m_html_aef5461a34124216ffeadd235c3f81324"><div class="ttname"><a href="load__nii__ext_8m.html#aef5461a34124216ffeadd235c3f81324">error</a></div><div class="ttdeci">error(msg)</div></div>
<div class="ttc" id="hellier__hist__normalization__gmm_8m_html_a61c2a47b64784151e1719e8205833341"><div class="ttname"><a href="hellier__hist__normalization__gmm_8m.html#a61c2a47b64784151e1719e8205833341">elseif</a></div><div class="ttdeci">end elseif(mu_i_first_subset &gt; mu_i_second_subset &amp;mu_i_first_subset &gt; mu_i_third_subset) disp('The first Gaussian is the WM')</div></div>
<div class="ttc" id="reslice__nii_8m_html_a1aabac6d068eef6a7bad3fdf50a05cc8"><div class="ttname"><a href="reslice__nii_8m.html#a1aabac6d068eef6a7bad3fdf50a05cc8">d</a></div><div class="ttdeci">d</div><div class="ttdef"><b>Definition:</b> <a href="reslice__nii_8m_source.html#l00217">reslice_nii.m:217</a></div></div>
<div class="ttc" id="reslice__nii_8m_html_aad05f78187c942f9dd521605fa81f1ba"><div class="ttname"><a href="reslice__nii_8m.html#aad05f78187c942f9dd521605fa81f1ba">M</a></div><div class="ttdeci">else M</div><div class="ttdef"><b>Definition:</b> <a href="reslice__nii_8m_source.html#l00253">reslice_nii.m:253</a></div></div>
<div class="ttc" id="emgm_8m_html_aa536745b29be7cb86f06124adedc5cc8"><div class="ttname"><a href="emgm_8m.html#aa536745b29be7cb86f06124adedc5cc8">integer</a></div><div class="ttdeci">the labels are integer</div><div class="ttdef"><b>Definition:</b> <a href="emgm_8m_source.html#l00001">emgm.m:1</a></div></div>
<div class="ttc" id="reslice__nii_8m_html_ae0323a9039add2978bf5b49550572c7c"><div class="ttname"><a href="reslice__nii_8m.html#ae0323a9039add2978bf5b49550572c7c">c</a></div><div class="ttdeci">c</div><div class="ttdef"><b>Definition:</b> <a href="reslice__nii_8m_source.html#l00216">reslice_nii.m:216</a></div></div>
<div class="ttc" id="emgm_8m_html_a67531ee5e31b1d1a3065cf637eae4546"><div class="ttname"><a href="emgm_8m.html#a67531ee5e31b1d1a3065cf637eae4546">function</a></div><div class="ttdeci">function[label, model, llh]</div><div class="ttdef"><b>Definition:</b> <a href="emgm_8m_source.html#l00001">emgm.m:1</a></div></div>
<div class="ttc" id="emgm_8m_html_ab66c175905713a9576f36f2fe09b9f21"><div class="ttname"><a href="emgm_8m.html#ab66c175905713a9576f36f2fe09b9f21">Flag</a></div><div class="ttdeci">the labels are Flag</div><div class="ttdef"><b>Definition:</b> <a href="emgm_8m_source.html#l00001">emgm.m:1</a></div></div>
<div class="ttc" id="emgm_8m_html_aaccc9105df5383111407fd5b41255e23"><div class="ttname"><a href="emgm_8m.html#aaccc9105df5383111407fd5b41255e23">t</a></div><div class="ttdeci">t</div><div class="ttdef"><b>Definition:</b> <a href="emgm_8m_source.html#l00018">emgm.m:18</a></div></div>
<div class="ttc" id="reslice__nii_8m_html_adc468c70fb574ebd07287b38d0d0676d"><div class="ttname"><a href="reslice__nii_8m.html#adc468c70fb574ebd07287b38d0d0676d">k</a></div><div class="ttdeci">k</div><div class="ttdef"><b>Definition:</b> <a href="reslice__nii_8m_source.html#l00232">reslice_nii.m:232</a></div></div>
<div class="ttc" id="hellier__hist__normalization__gmm_8m_html_a4797586c9f191ec7ffd84e764c4c54e7"><div class="ttname"><a href="hellier__hist__normalization__gmm_8m.html#a4797586c9f191ec7ffd84e764c4c54e7">for</a></div><div class="ttdeci">for(jj=1:length(first_subset)) if(first_subset(jj)&lt; mu_i_first_subset) standardized_hist(jj)</div></div>
<div class="ttc" id="reslice__nii_8m_html_a1ede835792071dff91c0e008e7c3b16a"><div class="ttname"><a href="reslice__nii_8m.html#a1ede835792071dff91c0e008e7c3b16a">a</a></div><div class="ttdeci">end else a</div><div class="ttdef"><b>Definition:</b> <a href="reslice__nii_8m_source.html#l00226">reslice_nii.m:226</a></div></div>
<div class="ttc" id="emgm_8m_html_a46bb007d223fe0b24732e6c9a65175b3"><div class="ttname"><a href="emgm_8m.html#a46bb007d223fe0b24732e6c9a65175b3">maxiter</a></div><div class="ttdeci">maxiter</div><div class="ttdef"><b>Definition:</b> <a href="emgm_8m_source.html#l00015">emgm.m:15</a></div></div>
<div class="ttc" id="reslice__nii_8m_html_adf1f3edb9115acb0a1e04209b7a9937b"><div class="ttname"><a href="reslice__nii_8m.html#adf1f3edb9115acb0a1e04209b7a9937b">T</a></div><div class="ttdeci">T</div><div class="ttdef"><b>Definition:</b> <a href="reslice__nii_8m_source.html#l00208">reslice_nii.m:208</a></div></div>
<div class="ttc" id="emgm_8m_html_a6b45d48125a6b8b1ee140eed24a0419f"><div class="ttname"><a href="emgm_8m.html#a6b45d48125a6b8b1ee140eed24a0419f">R</a></div><div class="ttdeci">R</div><div class="ttdef"><b>Definition:</b> <a href="emgm_8m_source.html#l00011">emgm.m:11</a></div></div>
<div class="ttc" id="reslice__nii_8m_html_a6f6ccfcf58b31cb6412107d9d5281426"><div class="ttname"><a href="reslice__nii_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a></div><div class="ttdeci">i</div><div class="ttdef"><b>Definition:</b> <a href="reslice__nii_8m_source.html#l00230">reslice_nii.m:230</a></div></div>
<div class="ttc" id="load__nii__img_8m_html_a0e58fe5bf1f468ebd8ae6b3620a52472"><div class="ttname"><a href="load__nii__img_8m.html#a0e58fe5bf1f468ebd8ae6b3620a52472">end</a></div><div class="ttdeci">end end[img, hdr]</div><div class="ttdef"><b>Definition:</b> <a href="load__nii__img_8m_source.html#l00115">load_nii_img.m:115</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Aug 11 2014 15:55:49 for ANIMA by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
